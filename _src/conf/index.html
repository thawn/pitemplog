---
layout: default
title: Database and Sensor Configuration
---
<style>
.small-gutter {
	margin-right: -5px;
	margin-left: -5px;
}

.small-gutter>[class*='col-'] {
	padding-right: 5px;
	padding-left: 5px;
}
</style>
<!-- Carousel
    ================================================== -->
<div id="myCarousel" class="carousel" data-ride="carousel">
	<div class="carousel-inner" role="listbox">
		<div class="item active">

			<div class="container">
				<div class="carousel-caption">
					<img class="pull-left" src="{{ site.baseurl }}/assets/img/config_icon1.png" alt="Config">
					<h1>Database and Sensor Configuration</h1>
					<p>All available sensors and their IDs should be listed here. Just add the database and Sensor information and
						the data will show up in the graphs.</p>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- /.carousel -->

<div class="container">
	<h2>Database status</h2>
	<div id="dbConfig" class="row small-gutter">
		<div class="col-sm-1">
			<div class="form-group">
				<label for="db-status-btn">Status:</label><br>
				<button id="db-status-btn" name="status-btn" class="btn btn-default" data-toggle="tooltip"
					title="Error: Cannot connect to the database.">
					<span class="glyphicon glyphicon-refresh"></span>
				</button>
			</div>
		</div>
		<div class="col-sm-2">
			<div class="form-group">
				<label for="db-check-btn">Action:</label><br>
				<button id="db-check-btn" class="btn btn-info" data-toggle="tooltip" title="Check the database connection.">
					<span class="glyphicon glyphicon-refresh"></span>
				</button>
			</div>
		</div>
	</div>
	<div id="local_sensors" style="display: none;">
		<hr>
		<h2>Local Sensor configuration</h2>
		<p>Enter Names for the sensors, the corresponding database tables to be used and a category in which the sensor
			will be shown on the start page.</p>
		<div class="row small-gutter hidden-xs">
			<div class="col-sm-2">
				<h5>Current Temperature:</h5>
			</div>
			<div class="col-sm-1">
				<h5>Cali&shy;bration:</h5>
			</div>
			<div class="col-sm-2">
				<h5>
					<span class="text-danger">*</span>Sensor Name:
				</h5>
			</div>
			<div class="col-sm-1">
				<h5>
					<span class="text-danger">*</span>Table Name:
				</h5>
			</div>
			<div class="col-sm-1">
				<h5>
					<span class="text-danger">*</span>Cate&shy;gory:
				</h5>
			</div>
			<div class="col-sm-2">
				<h5>Comment:</h5>
			</div>
			<div class="col-sm-1">
				<h5>Status:</h5>
			</div>
			<div class="col-sm-2">
				<h5>Action:</h5>
			</div>
		</div>
	</div>
	<div id="remote_sensors" style="display: none;">
		<hr>
		<h2>Remote Sensor configuration</h2>
		<p>Data from external sensors is fetched/received over the network instead of read out from local sensors.</p>
	</div>
	<div id="push_servers" style="display: none;">
		<hr>
		<h2>External Server configuration</h2>
		<p>Data from local sensors is pushed over the network to an external server. This is particularly useful, if there
			is a firewall between this pitemplog box and the external server that only allows connections from the box to the
			server.</p>
		<div class="row small-gutter hidden-xs">
			<div class="col-sm-3">
				<h5>
					<span class="text-danger">*</span>URL:
				</h5>
			</div>
			<div class="col-sm-3">
				<h5>
					<span class="text-danger">*</span>Name:
				</h5>
			</div>
			<div class="col-sm-3">
				<h5>
					<span class="text-danger">*</span>Api key:
				</h5>
			</div>
			<div class="col-sm-3">
				<h5>Action:</h5>
			</div>
		</div>
	</div>
	<div id="newExternal" style="display: none;">
		<hr>
		<button type="button" id="closeExternal" class="btn btn-info pull-right">
			<span class="glyphicon glyphicon-remove"></span> Close external data source configuration
		</button>
		<h2>Add New External Data Source/Target</h2>
		<p>There are three ways to exchange data with external sources/targets:</p>
		<dl>
			<dt>Fetch data:</dt>
			<dd>This server will actively fetch data from an external source every minute. The external source can be
				another pitemplog box or any source providing a web interface or api. In the latter case, you need to provide a
				parser that scrapes the data from the external source. An example parser for mibi sensors (mibi.php) is provided in
				the parsers directory.</dd>
			<dt>Send data:</dt>
			<dd>This server will send temperature data from locally attached sensors to an remote pitemplog server in
				regular intervals. Before sending data, the remote server needs to be configured in order to be able to receive the
				data. The configuration happens almost entirely automatically. For security reasons, the only manual step required
				is to copy the api key generated by the remote server to the configuration here.</dd>
			<dt>Receive data:</dt>
			<dd>This server will passively wait for input from an external source. In order to be able to receive data, this
				server must be properly configured. If the external source is a pitemplog box, the configuration is done
				automatically by the sender (see "Send data" above). If you want to send data to this sever from a different source
				(i.e. an arduino sensor), then you can configure the sensor id, name, table and category here.</dd>
		</dl>
		<div class="row hidden-xs">
			<div class="col-sm-4">
				<h3>Configure Fetching Data</h3>
				<p>Enter the URL and a name for the external sensor box. If the external box requires a username and password,
					you can enter those as well.</p>
			</div>
			<div class="col-sm-4">
				<h3>Configure Sending Data</h3>
				<p>Enter the URL and a name for a central server that is running pitemplog. Once the connection is set up, the
					temperature data of all local sensors will be regularly uploaded to this server.</p>
			</div>
			<div class="col-sm-4">
				<h3>Configure Receiving Data</h3>
				<p>Configure the sensor id (must be unique), name, table and category here. Once you are done, an api key will
					be automatically generated and you need to copy that to the sender in order to prevent anyone from pushing data to
					this server.</p>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-4">
				<div class="col-sm-4 visible-xs">
					<h3>Configure Fetching Data</h3>
					<p>Enter the URL and a name for the external sensor box. If the external box requires a username and password,
						you can enter those as well.</p>
				</div>
				<form id="newExternalForm">
					<div class="form-group">
						<label for="url"><span class="text-danger">*</span>URL:</label> <input id="newExtURL" class="form-control"
							name="url" placeholder="http://pitemplog/data.php" required value="http://pitemplog/data.php" type="text">
					</div>
					<div class="form-group ">
						<label for="name"><span class="text-danger">*</span>Name:</label> <input id="newExtName" class="form-control"
							name="name" placeholder="Enter a name for the box." required pattern="[a-zA-Z0-9_\- ]*" value="" type="text">
					</div>
					<div class="form-group ">
						<label for="user">Username:</label> <input id="newExtUsername" class="form-control" name="user"
							placeholder="username" value="" type="text">
					</div>
					<div class="form-group">
						<label for="pw">Password:</label> <input id="newExtPassword" class="form-control" name="pw" placeholder="password"
							value="" type="text">
					</div>
					<div class="form-group">
						<label for="parser">Parser: </label><br> <select id="newExtParser" class="form-control form-control-inline"
							name="parser" onchange="this.className=this.options[this.selectedIndex].className">
							<option value="none" class="form-control form-control-inline">no parser</option>
						</select>
					</div>
					<div class="form-group">
						<label for="getExternal">Action: </label><br>
						<button type="submit" id="getExternal" class="btn btn-primary" data-loading-text="Loading...">
							<span class="glyphicon glyphicon-cloud-download"></span> Download external configuration
						</button>
					</div>
				</form>
			</div>
			<div class="col-sm-4">
				<div class="col-sm-4 visible-xs">
					<h3>Configure Sending Data</h3>
					<p>Enter the URL and a name for a central server that is running pitemplog. Once the connection is set up, the
						temperature data of all local sensors will be regularly uploaded to this server.</p>
				</div>
				<form id="newPushServerForm">
					<div class="form-group">
						<label for="url"><span class="text-danger">*</span>URL:</label> <input class="form-control" name="url"
							placeholder="http://pitemplog/data.php" required value="http://pitemplog/data.php" type="text">
					</div>
					<div class="form-group ">
						<label for="name"><span class="text-danger">*</span>Name:</label> <input class="form-control" name="name"
							placeholder="Enter a name for the server." required pattern="[a-zA-Z0-9_\- ]*" value="" type="text">
					</div>
					<div class="form-group">
						<label for="push-external-btn">Action: </label><br>
						<button type="submit" name="push-external-btn" id="pushExternal" class="btn btn-info"
							data-loading-text="Loading...">
							<span class="glyphicon glyphicon-cloud-upload"></span> Upload configuration to central server
						</button>
					</div>
				</form>
			</div>
			<div class="col-sm-4">
				<div class="col-sm-4 visible-xs">
					<h3>Configure Receiving Data</h3>
					<p>Configure the sensor id (must be unique and start with 'custom-' in order to avoid collision with
						automatically pushed configurations.), name, table and category here. Once you are done, an api key will be
						automatically generated and you need to copy that to the sender in order to prevent anyone from pushing data to
						this server.</p>
				</div>
				<form id="newReceiveDataConfigForm">
					<input type="hidden" name="push" value="true">
					<input type="hidden" name="exttable" value="">
					<div class="form-group">
						<label for="exturl"><span class="text-danger">*</span>Source URL (or unique id of source):</label> <input id="newExtURL" class="form-control"
							name="exturl" placeholder="Enter an url or a unique id for the source." required value="" type="text">
					</div>
					<div class="form-group ">
						<label for="extname"><span class="text-danger">*</span>Source Name:</label> <input id="newExtName" class="form-control"
							name="extname" placeholder="Enter a name for the source." required pattern="[a-zA-Z0-9_\- ]*" value="" type="text">
					</div>
					<div class="form-group ">
						<label for="sensor"><span class="text-danger">*</span>Unique sensor ID:</label> <input type="text"
							class="form-control sensorID" name="sensor" placeholder="Please enter a unique sensor id" required
							pattern="custom-[a-zA-Z0-9_\- ]{4,80}" value="custom-" data-toggle="tooltip"
							title="Unique sensor ID. Must start with 'custom-' and at 4-80 more characters to avoid collisions with automatically pushed configurations.">
					</div>
					<div class="form-group ">
						<label for="calibration">Cali&shy;bration:</label> <input type="text" class="form-control" name="calibration"
							value="0.0" data-toggle="tooltip"
							title="This value will be added to the temperature when saving the data to the database.">
					</div>
					<div class="form-group ">
						<label for="name"><span class="text-danger">*</span>Sensor Name:</label> <input type="text" class="form-control"
							name="name" placeholder="Enter Sensor Name" required pattern="[a-zA-Z0-9_\- ]*" value=""
							placeholder="Sensor Name" data-toggle="tooltip" title="Name of the sensor.">
					</div>
					<div class="form-group">
						<label for="table"><span class="text-danger">*</span>Table Name:</label> <input type="text" class="form-control"
							name="table" placeholder="Enter Database Table Name" required pattern="[a-zA-Z][a-zA-Z0-9_]{3,19}" value=""
							placeholder="name" data-toggle="tooltip"
							title="Name of the database table. Only letters, numbers and underscore allowed. Must start with a letter and between 4 and 20 characters long.">
						<input type="hidden" name="table_old">
					</div>
					<div class="form-group">
						<label for="category"><span class="text-danger">*</span>Category:</label> <input type="text" class="form-control"
							name="category" placeholder="Enter Category" required pattern="[a-zA-Z0-9_\- ]*" value="" data-toggle="tooltip"
							title="Category of the sensor. Will be used to group sensors on the overview page.">
					</div>
					<div class="form-group">
						<label for="comment">Comment:</label> <input type="text" class="form-control" name="comment"
							placeholder="Enter Comment" value="" data-toggle="tooltip" title="Comment describing the sensor.">
					</div>
					<div class="form-group">
						<label for="save-btn">Action:</label><br>
						<button name="save-btn" type="submit" class="btn btn-primary" data-toggle="tooltip"
							title="Save configuration as remote sensor.">
							<span class="glyphicon glyphicon-save"></span> Save new receive config
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	<hr>
	<div class="row">
		<div class="col-sm-12">
			<button type="button" id="addExternal" class="btn btn-info">
				<span class="glyphicon glyphicon-plus"></span> Add external data source
			</button>
		</div>
	</div>
	<hr>
	<div class="row">
		<div class="col-sm-12 text-center">
			<button id="saveEverythingButton" class="btn btn-lg btn-primary" data-loading-text="Saving..." value="">Save
				entire configuration</button>
		</div>
	</div>
	<div id="messageWindow" style="display: none;">
		<hr>
		<h2>Messages:</h2>
	</div>
</div>
<div class="container" style="display: none;">
	<div id="externalSensorHeading-template">
		<hr>
		<h3>External Sensor Name</h3>
		<p>URL of external sensor</p>
		<!-- ui to edit external configuration will go here. -->
		<div class="row small-gutter hidden-xs">
			<div class="col-sm-2">
				<h5>Current Temperature:</h5>
			</div>
			<div class="col-sm-1">
				<h5>Cali&shy;bration:</h5>
			</div>
			<div class="col-sm-2">
				<h5>
					<span class="text-danger">*</span>Sensor Name:
				</h5>
			</div>
			<div class="col-sm-1">
				<h5>
					<span class="text-danger">*</span>Table Name:
				</h5>
			</div>
			<div class="col-sm-1">
				<h5>
					<span class="text-danger">*</span>Cate&shy;gory:
				</h5>
			</div>
			<div class="col-sm-2">
				<h5>Comment:</h5>
			</div>
			<div class="col-sm-1">
				<h5>Status:</h5>
			</div>
			<div class="col-sm-2">
				<h5>Action:</h5>
			</div>
		</div>
	</div>
	<div id="element-template">
		<h3 class="sensor-title visible-xs">Sensor 28-000323058:</h3>
		<form class="sensor-form">
			<input type="hidden" class="sensorID" name="sensor" value=""> <input type="hidden" name="enabled"
				value="true">
			<div class="row small-gutter">
				<div class="col-sm-2">
					<div class="form-group">
						<label class="visible-xs" for="temperature">Current Temperature:</label>
						<div class="input-group">
							<span class="input-group-addon"><span class="glyphicon glyphicon-refresh"></span></span> <input type="text"
								class="form-control" name="temperature" value="" placeholder="Reading..." disabled data-toggle="tooltip"
								title="The current temperature of this sensor.">
						</div>
					</div>
				</div>
				<div class="col-sm-1">
					<div class="form-group ">
						<label class="visible-xs" for="calibration">Cali&shy;bration:</label> <input type="text" class="form-control"
							name="calibration" value="0.0" data-toggle="tooltip"
							title="This value will be added to the temperature when saving the data to the database.">
					</div>
				</div>
				<div class="col-sm-2">
					<div class="form-group ">
						<label class="visible-xs" for="name"><span class="text-danger">*</span>Sensor Name:</label> <input type="text"
							class="form-control" name="name" placeholder="Enter Sensor Name" required pattern="[a-zA-Z0-9_\- ]*" value=""
							placeholder="Sensor Name" data-toggle="tooltip" title="Name of the sensor.">
					</div>
				</div>
				<div class="col-sm-1">
					<div class="form-group">
						<label class="visible-xs" for="table"><span class="text-danger">*</span>Table Name:</label> <input type="text"
							class="form-control" name="table" placeholder="Enter Database Table Name" required
							pattern="[a-zA-Z][a-zA-Z0-9_]{3,19}" value="" placeholder="name" data-toggle="tooltip"
							title="Name of the database table. Only letters, numbers and underscore allowed. Must start with a letter and between 4 and 20 characters long.">
						<input type="hidden" name="table_old">
					</div>
				</div>
				<div class="col-sm-1">
					<div class="form-group">
						<label class="visible-xs" for="category"><span class="text-danger">*</span>Category:</label> <input type="text"
							class="form-control" name="category" placeholder="Enter Category" required pattern="[a-zA-Z0-9_\- ]*" value=""
							data-toggle="tooltip" title="Category of the sensor. Will be used to group sensors on the overview page.">
					</div>
				</div>
				<div class="col-sm-2">
					<div class="form-group">
						<label class="visible-xs" for="comment">Comment:</label> <input type="text" class="form-control" name="comment"
							placeholder="Enter Comment" value="" data-toggle="tooltip" title="Comment describing the sensor.">
					</div>
				</div>
				<div class="col-sm-1">
					<div class="form-group">
						<label class="visible-xs" for="status-btn">Status:</label>
						<button name="status-btn" class="btn btn-default" data-toggle="tooltip"
							title="An error has occurred, the sensor is not configured properly.">
							<span class="glyphicon glyphicon-refresh"></span>
						</button>
					</div>
				</div>
				<div class="col-sm-2">
					<div class="form-group">
						<label class="visible-xs" for="save-btn">Action:<br></label>
						<button name="save-btn" type="submit" class="btn btn-primary" data-toggle="tooltip"
							title="Save the configuration for this sensor.">
							<span class="glyphicon glyphicon-save"></span>
						</button>
						<button name="disable-btn" class="btn btn-warning" style="display: none;" data-toggle="tooltip"
							title="Disable this sensor.">
							<span class="glyphicon glyphicon-pause"></span>
						</button>
						<button name="delete-btn" class="btn btn-danger" style="display: none;" data-toggle="tooltip"
							title="Delete this sensor.">
							<span class="glyphicon glyphicon-remove"></span>
						</button>
					</div>
				</div>
			</div>
		</form>
	</div>
	<div id="pushServerTemplate">
		<h3 class="sensor-title visible-xs">Push server: url</h3>
		<form class="push-server-form">
			<div class="row small-gutter">
				<div class="col-sm-3">
					<div class="form-group">
						<label class="visible-xs" for="url"><span class="text-danger">*</span>URL:</label> <input class="form-control"
							name="url" placeholder="http://pitemplog/data.php"
							value="" type="text">
					</div>
				</div>
				<div class="col-sm-3">
					<div class="form-group ">
						<label class="visible-xs" for="name"><span class="text-danger">*</span>Name:</label> <input class="form-control"
							name="name" placeholder="Enter a name for the external server" value="" type="text">
					</div>
				</div>
				<div class="col-sm-3">
					<div class="form-group ">
						<label class="visible-xs" for="apikey"><span class="text-danger">*</span>Api key:</label> <input class="form-control" 
							name="apikey" placeholder="Please copy and paste the api key from the target server's configuration page" value="" type="text">
					</div>
				</div>
				<!-- 
				<div class="col-sm-2">
					<div class="form-group ">
						<label class="visible-xs" for="user"><span class="text-danger">*</span>Username:</label> <input
							class="form-control" name="user" placeholder="username" value="" type="text">
					</div>
				</div>
				<div class="col-sm-2">
					<div class="form-group">
						<label class="visible-xs" for="pw"><span class="text-danger">*</span>Password:</label> <input
							class="form-control" name="pw" placeholder="password" value="" type="text">
					</div>
				</div>
				 -->
				<div class="col-sm-3">
					<div class="form-group">
						<label class="visible-xs" for="save-btn">Action: </label>
						<button name="save-btn" type="submit" class="btn btn-primary" data-toggle="tooltip"
							title="Save the configuration for this push server.">
							<span class="glyphicon glyphicon-save"></span>
						</button>
						<button name="push-external-btn" type="submit" class="btn btn-info" data-toggle="tooltip"
							title="Update the sensor configuration on the server. IMPORTANT: This will cause the server to change the API key, therefore, you need to copy and paste the new api key from the server config page.">
							<span class="glyphicon glyphicon-refresh"></span>
						</button>
						<button name="delete-server-btn" class="btn btn-danger" data-toggle="tooltip"
							title="Stop pushing data to this server.">
							<span class="glyphicon glyphicon-remove"></span>
						</button>
					</div>
				</div>
			</div>
		</form>
	</div>
</div>
{% include js.html %}
<!-- build:js {{site.baseurl}}/assets/js/conf.min.js -->
<script src="{{ site.baseurl }}/assets/js/conf.js" type="text/javascript"></script>
<!-- /build -->